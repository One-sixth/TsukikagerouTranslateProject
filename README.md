# TsukikagerouTranslateProject
月阳炎开源翻译计划  
Tsukikagerou Translate Project  

本项目所有工具均开源  
其中  
编译 C++ 项目需要 VS2019 和 C++20 版本的支持。  
运行 Python 项目需要 Python3.9 或更新版本。  

# 状态
此项目长期开放，等待有爱的大佬和文豪前来加工。  

当前翻译字典已由本人轻微处理了下，简单用查找替换修正了人称的一些错误。  

- [x] ARC资源解包
- [x] ARC资源打包
- [x] SNR解密
- [x] SNR加密
- [x] SNR剧本提取
- [x] SNR剧本封包
- [x] 启动程序本地化修改
- [x] 千秋恋歌也是？！
- [x] 百度机翻
- [ ] 人工汉化
- [ ] 文本校对
- [ ] 需要大文豪润色！

# 现成的翻译补丁  
你可以在Release里面下载最新的翻译补丁。  

# 各目录以及文件介绍
/origin                     存放着原始文件  
/patch_game_exe             已修改的文件  
/tools                      翻译解包打包工具  
/tools_src                  翻译解包打包工具源代码  
/月阳炎                     月阳炎翻译工作目录  
/千秋恋歌                   千秋恋歌翻译工作目录  
/cache_tr.json              翻译字典  
/cache_tr.json.bak          翻译字典自动备份，防止翻译字典意外损坏导致的翻译数据丢失  
/install_requirement.cmd    翻译工具的依赖包安装脚本  
/README.md                  本文档  

# 系统需求
系统要求：Windows10或以上。WindowsXP无法直接运行。  
环境需求：Python3  
系统字符集：GB2312，如果是其他字符集，则需要手动修改一些东西。  
游戏版本需求：月阳炎需要版本为v1.05 ；千秋恋歌v1.02  

# 现成的翻译补丁使用步骤
你可以在Release里面下载最新的翻译补丁。  
解压后，覆盖到游戏的根目录，好了，翻译完成。  
存档是通用。你可能会看到存档名称是乱码和读取后第一句话是乱码，这是正常现象。  

# 使用仓库内工具手动汉化的步骤
## 如果你只想使用翻译补丁，请看上面的翻译补丁使用步骤，不用看下面
## 注意！如果你要看的你翻译是否有效，记得在要翻译的本句话的之前存档。因为读档后的显示的第一句话，是通过读取存档文件获得的，而不是从游戏剧本文件中获得的，因而会看不到你的翻译改动！

## 第一步，下载本仓库。
自己找办法。。。  

## 第二步，替换掉游戏的启动文件
进入 patch_game_exe 文件夹。找到里面的 tuki_fun.exe 和 tukikage.exe，然后替换掉原始游戏文件。

## 第三步，安装翻译工具所需的python3和依赖库
安装python 3.9或以上的版本  
双击 install_requirement.cmd 脚本将会自动帮你安装依赖库  

## 第四步，注册百度翻译API
这一步可以跳过，但不建议跳过。  
翻译工具使用了百度机翻。  
去到这里 https://api.fanyi.baidu.com/doc/21  
按提示注册百度通用翻译API，只需要百度账号就行了，而且也是秒审核通过。  
获得百度翻译API的 APPID和KEY  

## 第五步，选择你要翻译的游戏
选择你要翻译的游戏，然后进入里面。以下以"月阳炎"为例。  
进入 月阳炎 文件夹。  

## 第六步，填入你的百度翻译APPID和KEY
用文本编辑器打开 "4.月阳炎-翻译导出的文本.cmd" 脚本。 推荐使用Notepad++
如果你跳过了第二步  
把 --baidu_appid=XXXX 的 XXXX 改为 ""  
把 --baidu_key=XXXX 的 XXXX 改为 ""  
如果你没有跳过第二步  
把 --baidu_appid=XXXX 的 XXXX 改为 你获得的百度翻译通用接口的APPID  
把 --baidu_key=XXXX 的 XXXX 改为 你获得的百度翻译通用接口的KEY  
然后保存。  

## 第七步，开始翻译
这步非常简单！  
依次双击启动以下脚本  
记得要等上一个脚本执行完成（脚本界面能看到Success字样）才能启动下一个脚本！  
```
1.月阳炎-解包ARC包.cmd  
2.月阳炎-解密SNR文件.cmd  
3.月阳炎-导出已解密SNR文件的文本.cmd  
4.月阳炎-翻译导出的文本.cmd  
5.月阳炎-打包翻译后的文本.cmd  
6.月阳炎-加密SNR文件.cmd  
7.月阳炎-打包ARC包.cmd  
```

# 第八步，替换掉游戏内同名文件
然后你可以 7.月阳炎-ARC打包后 文件夹里面找到翻译好和打包好的剧本文件。  
然后剪切该文件替换掉游戏内同名文件。  
现在你可以启动游戏，看到游戏被翻译了！  

# 第九步，更新翻译
## 注意先把你的 cache_tr.json 文件备份一份，便于修改错地方导致无法封包。
cache_tr.json 是json格式的翻译字典  
左边的日文文本千万不要动。你要更新的只有右边的翻译文本。  
当你修正完翻译字典后，保存。  
现在，你只需要按顺序执行以下脚本，文件夹 7.月阳炎-ARC打包后 就可以看到已更新翻译的已打包文件  
```
4.月阳炎-翻译导出的文本.cmd  
5.月阳炎-打包翻译后的文本.cmd  
6.月阳炎-加密SNR文件.cmd  
7.月阳炎-打包ARC包.cmd  
```
把它剪切到你的游戏目录，即可更新翻译。  

# 千秋恋歌的翻译方式与上方说明的操作一致。

# 使用协议
本仓库内的origin文件夹的内容由它们本身的协议限制。  
本仓库内所有代码均使用GPLv3协议，除此以外，还包含以下限制。  
本仓库内除origin文件夹以外全部内容均严禁用于任何直接或间接的商业行为和商业用途，也严禁用于任何虚拟物品的互换和交易。  
如果你想要转载或原样提供或修改后提供本仓库除了origin文件夹以外的任何内容，不得设定任何要求的门槛（例如必须要注册才能下载或观看，要求支付论坛币才能下载等行为）和不能要求任何费用（必须以无偿的方式提供）。  
如果你希望基于本仓库将其游戏翻译为其他语言，请在遵守以上协议的情况进行即可。  

# 参考和引用
https://github.com/morkt/GARbro GAL游戏资源通用浏览器，ARC打包解包算法和月阳炎的完整的SNR解密算法来自这里  
https://github.com/nlohmann/json C++项目中使用的单头json库，真的非常好用  
https://github.com/fxfactorial/sdefl C++项目中使用的单头deflate压缩和解压库，也非常好用，只是可能会出现堆栈溢出的问题  
https://github.com/jarro2783/cxxopts C++项目中使用的单头命令行工具，非常ok  
千秋恋歌的snr解密加密算法是从游戏里面爬出来的。  
